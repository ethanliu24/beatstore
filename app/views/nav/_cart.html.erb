<div id="navbar_cart">
  <%# TODO add actual amount in cart %>
  <%= render Ui::DropdownComponent.new(
    id: "nav-cart-dropdown",
    classes: "absolute top-full rounded-lg shadow-sm hidden w-auto select-none text-primary-txt bg-background divide-y"
  ) do |dropdown| %>
    <%= dropdown.with_trigger_button(
      id: "nav-cart-dropdown",
      classes: "nav-dropdown",
      data: { dropdown_placement: "bottom-end" }
    ) do %>
      <%= icon "shopping-bag", class: "w-6 h-6 text-primary-txt" %>
      <%= current_or_guest_user.cart.total_price %>
      <%= icon "chevron-down", class: "w-3 h-3 text-secondary-txt" %>
    <% end %>

    <%= dropdown.with_section do %>
      <div class="p-4 pb-0 text-gray-900 md:pb-4 dark:text-white w-70 min-w-70 max-w-70 select">
        <div class="text-[1rem] mb-4"><%= t("cart.nav.title", count: current_or_guest_user.cart.total_items) %></div>

        <% if current_or_guest_user.cart.empty? %>
          <div class="flex flex-col justify-center items-center w-full h-full py-10 text-center">
            <%= icon "shopping-cart", class: "w-20 h-20 aspect-square text-secondary-txt mb-2" %>
            <p class="text-lg"><%= t("cart.nav.empty_title") %></p>
            <p class="font-light text-secondary-txt text-wrap"><%= t("cart.nav.empty_subtitle") %></p>
          </div>
        <% else %>
          <div class="flex flex-col justify-start items-center gap-2 w-full h-full">
            <% current_or_guest_user.cart.items.each do |item| %>
              <div class="flex justify-between items-center gap-2 w-full">
                <div class="w-10 h-10 aspect-square">
                  <% if cart_item_has_photo?(item) %>
                    <%= image_tag cart_item_photo_url(item), class: "rounded" %>
                  <% else %>
                    <div class="border-1 border-hover rounded w-full h-full flex justify-center items-center bg-hover">
                      <%= icon "photo-scan", class: "w-6 h-6 aspect-square" %>
                    </div>
                  <% end %>
                </div>
                <% if item.available? %>
                  <div class="flex-1 flex flex-col justify-between items-start truncate">
                    <p class="truncate w-full"><%= cart_item_product_title(item) %></p>
                    <p class="text-[0.6rem] font-light text-secondary-txt"><%= item.product_type %></p>
                  </div>
                  <div>
                    <%= item.license.price.format %>
                  </div>
                <% else %>
                  <div class="flex-1">
                    <p class="text-secondary-txt font-light italic py-2">
                      <%= t("cart.nav.item_not_available") %>
                    </p>
                  </div>
                <% end %>
                <div class="flex justify-center items-center">
                  <%# TODO implement delete %>
                  <button class="text-center cursor-pointer">
                    <%= icon "x", class: "w-4 w-4" %>
                  </button>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
