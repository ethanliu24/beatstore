<%= search_form_for @q,
  class: "w-full",
  html: {
    data: {
      controller: "track-filter",
      turbo_frame: "track-list",
      turbo_action: "replace",
    }
  } do |f| %>
  <div class="flex justify-start items-stretch gap-3 relative w-full mb-4">
    <%= icon "search", class: "absolute w-4 aspect-square top-1/2 left-0 -translate-y-1/2 ml-2" %>
    <%= f.text_field :title_or_description_or_tags_name_i_cont, autocomplete: "off", class:
      "flex-1 pl-9 py-1 border-1 border-secondary-txt/50 focus:outline-none focus:ring-1 focus:ring-accent rounded" %>
    <%= f.submit t("label.search"), class: "border-1 border-primary-txt rounded cursor-pointer px-2" %>
    <%= f.submit t("label.clear"), class: "border-1 border-secondary-txt text-secondary-txt rounded cursor-pointer px-2" %>
    <%# TODO hook to controller %>
  </div>

  <div class="flex justify-start flex-stretch gap-4 text-xs text-secondary-txt font-light select-none mb-2">
    <% [
      {
        field: t("label.genre"),
        dropdown_id: "genre-selection-dropdown",
      },
    ].each do |data| %>
      <button id="<%= "#{data[:dropdown_id]}-btn" %>" data-dropdown-toggle="<%= data[:dropdown_id] %>" type="button"
        class="flex justify-center items-center gap-1 bg-none cursor-pointer">
        <%= data[:field] %>
        <%= icon "chevron-down", class: "w-3 aspect-square" %>
      </button>
    <% end %>

    <!-- Genre Selection Dropdown -->
    <div id="genre-selection-dropdown" class="z-10 hidden bg-background dark:bg-secondary-bg rounded-lg shadow-sm">
      <ul class="p-1" aria-labelledby="genre-selection-dropdown-btn" data-track-filter-target="genreDropdown">
        <% genre_options.each do |genre| %>
          <li class="cursor-pointer">
            <div class="flex items-center p-2 rounded-sm hover:bg-hover">
              <%= check_box_tag "q[genre_cont_any][]", genre, params.dig(:q, :genre_cont_any)&.include?(genre),
                id: "genre-selection-#{genre.parameterize(separator: '-')}",
                class: "w-3 h-3 cursor-pointer rounded accent-accent",
                data: { action: "change->track-filter#updateGenre" } %>
              <label for="<%= "genre-selection-#{genre.parameterize(separator: '-')}" %>" class="w-full h-full ms-2 cursor-pointer font-medium"><%= genre %></label>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="flex justify-start items-stretch gap-2">
    <% [
      { title: t("label.genre"), id: "genre-chip", action: "click->track-filter#clearGenre" }
    ].each do |chip| %>
      <div class="hidden w-fit h-fit whitespace-nowrap bg-secondary-bg rounded-full px-2 py-0.5"
        data-track-filter-target="genreChip">
        <span class="flex justify-center items-center flex-nowrap gap-1">
          <span id="<% chip[:id] %>" class="text-secondary-txt text-[0.6rem]">
            <%= "#{chip[:title]}:" %>
          </span>
          <p class="track-filter-chip-text text-[0.6rem]"></p>
          <div class="w-fit h-fit cursor-pointer" data-action="<%= chip[:action] %>">
            <%= icon "x", class: "w-3 h-3 aspect-square" %>
          </div>
        </span>
      </div>
    <% end %>
  </div>
<% end %>
