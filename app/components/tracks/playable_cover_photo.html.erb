<div class="relative"
  style="<%= "#{image_size}" %>"
  data-controller="playable-cover-photo" data-playable-cover-photo-target="container"
  data-playable-cover-photo-audio-outlet="#audio-controller"
  data-playable-cover-photo-audio-player-outlet="#audio-player-controller"
  data-playable-cover-photo-track-id-value="<%= track.id %>"
  data-track-id="<%= track.id %>"
  data-track-title="<%= track.title %>"
  data-track-image-url="<%= track.cover_photo.attached? ? track.cover_photo.url : "" %>"
  data-track-metadata="<%= "#{track.bpm} • #{track.key} • #{track.genre}" %>"
  data-queue-scope="<%= queue_scope %>"
>

  <% cover_photo = capture do %>
    <% if track.cover_photo.attached? %>
      <%= image_tag url_for(track.cover_photo), class: "cover-photo object-cover rounded w-full h-full" %>
    <% else %>
      <%= content_tag :div, class: "flex justify-center items-center bg-secondary-bg rounded w-full h-full" do %>
        <%= icon "photo-scan", class: "cover-photo w-1/4 h-1/4" %>
      <% end %>
    <% end %>
  <% end %>

  <% if controller.controller_name == "tracks" && controller.action_name == "show" %>
    <%= cover_photo %>
  <% else %>
    <%= link_to track_path(id: track.slug_param), class: "w-fit h-fit" do %>
      <%= cover_photo %>
    <% end %>
  <% end %>

  <div class="absolute bottom-2 right-2 bg-background rounded-full p-2 hover:bg-hover cursor-pointer select-none"
    data-action="click->playable-cover-photo#togglePlay">
    <%= icon "player-play", variant: "filled", class: "w-5 h-5", data: {
      playable_cover_photo_target: "play",
      action: "click->playable-cover-photo#pause"
    } %>
    <%= icon "player-pause", variant: "filled", class: "hidden w-5 h-5", data: {
      playable_cover_photo_target: "pause",
      action: "click->playable-cover-photo#play"
    } %>
  </div>
</div>
